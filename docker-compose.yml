# ChargeMyHyundai Price Map - Docker Compose
# For use with Traefik reverse proxy

services:
  chargemyhyundai-map:
    image: b0t.at/b0t-at-public/chargemyhyundai-map:latest
    container_name: chargemyhyundai-map
    restart: unless-stopped
    
    # Environment variables (optional overrides)
    environment:
      - FLASK_ENV=production
      - TZ=Europe/Vienna
    
    # No port mapping needed - Traefik handles routing
    # Uncomment below for direct access without Traefik
    # ports:
    #   - "5000:5000"
    
    networks:
      - proxy
    
    # Resource limits (adjust as needed)
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 256M
        reservations:
          cpus: '0.1'
          memory: 128M
    
    # Traefik labels for routing
    labels:
      - "traefik.enable=true"
      
      # HTTP Router
      - "traefik.http.routers.chargemyhyundai.rule=Host(`chargemyhyundai.example.com`)"
      - "traefik.http.routers.chargemyhyundai.entrypoints=websecure"
      - "traefik.http.routers.chargemyhyundai.tls=true"
      - "traefik.http.routers.chargemyhyundai.tls.certresolver=letsencrypt"
      
      # Service configuration
      - "traefik.http.services.chargemyhyundai.loadbalancer.server.port=5000"
      
      # Optional: HTTP to HTTPS redirect
      - "traefik.http.routers.chargemyhyundai-http.rule=Host(`chargemyhyundai.example.com`)"
      - "traefik.http.routers.chargemyhyundai-http.entrypoints=web"
      - "traefik.http.routers.chargemyhyundai-http.middlewares=https-redirect@file"
      
      # Optional: Security headers middleware
      # - "traefik.http.routers.chargemyhyundai.middlewares=security-headers@file"

    # Health check
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:5000/')"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s

networks:
  proxy:
    external: true
